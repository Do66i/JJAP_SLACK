"use strict";(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[256],{5256:function(e,t,n){n.r(t),n.d(t,{default:function(){return x}});var a=n(2309),r=n(2545),l=n(9250),o=n(8678),c=n(2951),i=n(6482),s=(0,i.Z)("div",{target:"enhg4lt2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),u=(0,i.Z)("header",{target:"enhg4lt1"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"}),f=(0,i.Z)("div",{target:"enhg4lt0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"}),d=n(3564),h=n(8667),p=n(9669),g=n.n(p),m=n(7294),v=n(6974),b=n(8100),w=n(4593);function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,c=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);o=!0);}catch(e){c=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(c)throw r}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var x=function(){var e,t,n=(0,v.UO)(),i=n.workspace,p=n.channel,k=(0,b.ZP)("/api/users",d.Z).data,x=y((0,o.Z)(""),3),C=x[0],Z=x[1],E=x[2],S=(0,b.ZP)("/api/workspaces/".concat(i,"/channels/").concat(p),d.Z).data,T=(0,w.ZP)((function(e){return"/api/workspaces/".concat(i,"/channels/").concat(p,"/chats?perPage=20&page=").concat(e+1)}),d.Z),_=T.data,A=T.mutate,D=T.setSize,I=(0,b.ZP)(k?"/api/workspaces/".concat(i,"/channels/").concat(p,"/members"):null,d.Z).data,j=y((0,c.Z)(i),1)[0],z=0===(null==_||null===(e=_[0])||void 0===e?void 0:e.length)||_&&(null===(t=_[_.length-1])||void 0===t?void 0:t.length)<20||!1,F=(0,m.useRef)(null),P=y((0,m.useState)(!1),2),U=P[0],B=P[1],O=y((0,m.useState)(!1),2),M=O[0],N=O[1],R=(0,m.useCallback)((function(e){if(e.preventDefault(),console.log(C),null!=C&&C.trim()&&_&&S){var t=C;A((function(e){var n;return null==e||e[0].unshift({id:((null===(n=_[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,UserId:k.id,User:k,ChannelId:S.id,Channel:S,createdAt:new Date}),e}),!1).then((function(){var e;E(""),null===(e=F.current)||void 0===e||e.scrollToBottom()})),g().post("/api/workspaces/".concat(i,"/channels/").concat(p,"/chats"),{content:C}).then((function(){A()})).catch(console.error)}}),[C,_,k,S,i,p]),H=(0,m.useCallback)((function(e){e.Channel.name!==p||!e.content.startsWith("uploads\\")&&e.UserId===(null==k?void 0:k.id)||A((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){var e;F.current&&F.current.getScrollHeight()<F.current.getClientHeight()+F.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=F.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=F.current)||void 0===e||e.scrollToBottom()}),50))}))}),[p,k]);(0,m.useEffect)((function(){return null==j||j.on("message",H),function(){null==j||j.off("message",H)}}),[j,H]),(0,m.useEffect)((function(){1===(null==_?void 0:_.length)&&setTimeout((function(){var e;null===(e=F.current)||void 0===e||e.scrollToBottom()}),500)}),[_]);var V=(0,m.useCallback)((function(){B(!0)}),[]),W=(0,m.useCallback)((function(){B(!1)}),[]),$=((0,m.useCallback)((function(e){var t=new FormData;if(e.target.files)for(var n=0;n<e.target.files.length;n++){var a=e.target.files[n].getAsFile();t.append("image",a)}g().post("/api/workspaces/".concat(i,"/channels/").concat(p,"/images"),t).then((function(){}))}),[]),(0,m.useCallback)((function(e){e.preventDefault();var t=new FormData;if(e.dataTransfer.items){for(var n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){var a=e.dataTransfer.items[n].getAsFile();t.append("image",a)}}else for(var r=0;r<e.dataTransfer.files.length;r++)t.append("image",e.dataTransfer.files[r]);g().post("/api/workspaces/".concat(i,"/channels/").concat(p,"/images"),t).then((function(){N(!1)}))}),[i,p])),q=(0,m.useCallback)((function(e){e.preventDefault(),console.log(e),N(!0)}),[]);if(!k||!k)return null;var G=(0,h.Z)(_?_.flat().reverse():[]);return m.createElement(s,{onDrop:$,onDragOver:q},m.createElement(u,null,m.createElement("span",null,"#",p),m.createElement("div",{className:"header-right"},m.createElement("span",null,null==I?void 0:I.length),m.createElement("button",{onClick:V,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},m.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),m.createElement(r.Z,{chatSections:G,scrollRef:F,setSize:D,isReachingEnd:z}),m.createElement(a.Z,{chat:C,onChangeChat:Z,onSubmitForm:R}),m.createElement(l.Z,{show:U,onCloseModal:W,setShowInviteChannelModal:B}),M&&m.createElement(f,null,"업로드!"))}}}]);