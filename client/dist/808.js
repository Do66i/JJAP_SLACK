"use strict";(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[808],{808:function(e,t,n){n.r(t);var a=n(2309),r=n(2545),l=n(9250),o=n(8678),c=n(2951),i=n(9732),u=n(3564),s=n(8667),f=n(9669),d=n.n(f),h=n(7294),p=n(6974),m=n(8100),v=n(4593);function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,c=!1;try{for(n=n.call(e);!(o=(a=n.next()).done)&&(l.push(a.value),!t||l.length!==t);o=!0);}catch(e){c=!0,r=e}finally{try{o||null==n.return||n.return()}finally{if(c)throw r}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}t.default=function(){var e,t,n=(0,p.UO)(),f=n.workspace,b=n.channel,k=(0,m.ZP)("/api/users",u.Z).data,w=g((0,o.Z)(""),3),y=w[0],C=w[1],E=w[2],S=(0,m.ZP)("/api/workspaces/".concat(f,"/channels/").concat(b),u.Z).data,Z=(0,v.ZP)((function(e){return"/api/workspaces/".concat(f,"/channels/").concat(b,"/chats?perPage=20&page=").concat(e+1)}),u.Z),T=Z.data,_=Z.mutate,A=Z.setSize,D=(0,m.ZP)(k?"/api/workspaces/".concat(f,"/channels/").concat(b,"/members"):null,u.Z).data,I=g((0,c.Z)(f),1)[0],F=0===(null==T||null===(e=T[0])||void 0===e?void 0:e.length)||T&&(null===(t=T[T.length-1])||void 0===t?void 0:t.length)<20||!1,P=(0,h.useRef)(null),U=g((0,h.useState)(!1),2),O=U[0],j=U[1],B=g((0,h.useState)(!1),2),M=B[0],N=B[1],R=(0,h.useCallback)((function(e){if(e.preventDefault(),null!=y&&y.trim()&&T&&S&&k){var t=y;_((function(e){var n;return null==e||e[0].unshift({id:((null===(n=T[0][0])||void 0===n?void 0:n.id)||0)+1,content:t,UserId:k.id,User:k,ChannelId:S.id,Channel:S,createdAt:new Date}),e}),!1).then((function(){var e;E(""),null===(e=P.current)||void 0===e||e.scrollToBottom()})),d().post("/api/workspaces/".concat(f,"/channels/").concat(b,"/chats"),{content:t}).then((function(){_()})).catch(console.error)}}),[y,f,b,S,k,T,_,E]),W=(0,h.useCallback)((function(e){e.Channel.name!==b||!e.content.startsWith("uploads\\")&&e.UserId===(null==k?void 0:k.id)||_((function(t){return null==t||t[0].unshift(e),t}),!1).then((function(){P.current&&P.current.getScrollHeight()<P.current.getClientHeight()+P.current.getScrollTop()+150&&setTimeout((function(){var e;null===(e=P.current)||void 0===e||e.scrollToBottom()}),50)}))}),[b,k]);(0,h.useEffect)((function(){return null==I||I.on("message",W),function(){null==I||I.off("message",W)}}),[I,W]),(0,h.useEffect)((function(){1===(null==T?void 0:T.length)&&setTimeout((function(){var e;null===(e=P.current)||void 0===e||e.scrollToBottom()}),500)}),[T]);var z=(0,h.useCallback)((function(){j(!0)}),[]),H=(0,h.useCallback)((function(){j(!1)}),[]),x=((0,h.useCallback)((function(e){var t=new FormData;if(e.target.files)for(var n=0;n<e.target.files.length;n++){var a=e.target.files[n].getAsFile();t.append("image",a)}d().post("/api/workspaces/".concat(f,"/channels/").concat(b,"/images"),t).then((function(){}))}),[]),(0,h.useCallback)((function(e){e.preventDefault();var t=new FormData;if(e.dataTransfer.items){for(var n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){var a=e.dataTransfer.items[n].getAsFile();t.append("image",a)}}else for(var r=0;r<e.dataTransfer.files.length;r++)t.append("image",e.dataTransfer.files[r]);d().post("/api/workspaces/".concat(f,"/channels/").concat(b,"/images"),t).then((function(){N(!1)}))}),[f,b])),K=(0,h.useCallback)((function(e){e.preventDefault(),console.log(e),N(!0)}),[]);if(!k||!k)return null;var $=(0,s.Z)(T?T.flat().reverse():[]);return h.createElement(i.W2,{onDrop:x,onDragOver:K},h.createElement(i.h4,null,h.createElement("span",null,"#",b),h.createElement("div",{className:"header-right"},h.createElement("span",null,null==D?void 0:D.length),h.createElement("button",{onClick:z,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},h.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),h.createElement(r.Z,{chatSections:$,scrollRef:P,setSize:A,isReachingEnd:F}),h.createElement(a.Z,{chat:y,onChangeChat:C,onSubmitForm:R}),h.createElement(l.Z,{show:O,onCloseModal:H,setShowInviteChannelModal:j}),M&&h.createElement(i.KW,null,"업로드!"))}}}]);