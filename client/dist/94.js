"use strict";(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[94],{3094:function(t,e,n){n.r(e),n.d(e,{default:function(){return k}});var r=n(7294),o=n(6482),a=(0,o.Z)("div",{target:"enpw7kx2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),l=(0,o.Z)("header",{target:"enpw7kx1"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"}),i=((0,o.Z)("div",{target:"enpw7kx0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"}),n(6182)),c=n.n(i),u=n(8100),s=n(4593),f=n(3564),d=n(6974),p=n(2309),m=n(2545),h=n(8678),v=n(9669),g=n.n(v),y=n(8667),b=n(2951);function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],l=!0,i=!1;try{for(n=n.call(t);!(l=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);l=!0);}catch(t){i=!0,o=t}finally{try{l||null==n.return||n.return()}finally{if(i)throw o}}return a}}(t,e)||x(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){if(t){if("string"==typeof t)return S(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,e):void 0}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var k=function(){var t,e,n,o=(0,d.UO)(),i=o.workspace,v=o.id,k=(0,u.ZP)("/api/workspaces/".concat(i,"/users/").concat(v),f.Z).data,Z=(0,u.ZP)("/api/users",f.Z).data,E=(0,s.ZP)((function(t){return"/api/workspaces/".concat(i,"/dms/").concat(v,"/chats?perPage=").concat(20,"&page=").concat(t+1)}),f.Z),A=E.data,I=E.mutate,C=E.setSize,T=(0,r.useRef)(null),j=w((0,h.Z)(""),3),R=j[0],z=j[1],P=j[2],B=w((0,b.Z)(i),1)[0],D=0===(null==A||null===(t=A[0])||void 0===t?void 0:t.length)||A&&(null===(e=A[A.length-1])||void 0===e?void 0:e.length)<20||!1,O=(0,r.useCallback)((function(t){if(t.preventDefault(),null!=R&&R.trim()&&A){var e=R;I((function(t){var n;return null==t||t[0].unshift({id:((null===(n=A[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,SenderId:Z.id,Sender:Z,ReceiverId:k.id,Receiver:k,createdAt:new Date}),t}),!1).then((function(){localStorage.setItem("".concat(i,"-").concat(v),(new Date).getTime().toString()),P(""),T.current&&T.current.scrollToBottom()})),g().post("/api/workspaces/".concat(i,"/dms/").concat(v,"/chats"),{content:R}).catch(console.error)}}),[R,i,v,Z,k,A,I,P]),H=(0,r.useCallback)((function(t){t.SenderId===Number(v)&&(null==Z?void 0:Z.id)!==Number(v)&&I((function(e){return null==e||e[0].unshift(t),e}),!1).then((function(){T.current&&T.current.getScrollHeight()<T.current.getClientHeight()+T.current.getScrollTop()+150&&setTimeout((function(){var t;null===(t=T.current)||void 0===t||t.scrollToBottom()}),50)}))}),[]);if((0,r.useEffect)((function(){return null==B||B.on("dm",H),function(){null==B||B.off("dm",H)}}),[B,H]),(0,r.useEffect)((function(){var t;1===(null==A?void 0:A.length)&&(null===(t=T.current)||void 0===t||t.scrollToBottom())}),[A]),!k||!Z)return null;var N,U=(0,y.Z)(A?(n=[]).concat.apply(n,(N=A,function(t){if(Array.isArray(t))return S(t)}(N)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(N)||x(N)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).reverse():[]);return r.createElement(a,null,r.createElement(l,null,r.createElement("img",{src:c().url(null==k?void 0:k.email,{s:"24px",d:"retro"}),alt:null==k?void 0:k.toString()}),r.createElement("span",null,null==k?void 0:k.nickname)),r.createElement(m.Z,{chatSections:U,scrollRef:T,setSize:C,isReachingEnd:D}),r.createElement(p.Z,{chat:R,onChangeChat:z,onSubmitForm:O}))}}}]);